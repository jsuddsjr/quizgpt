{% extends 'base.html' %}

{% block content %}
  <h1 class="display-4">What do you want to learn today?</h1>

  <div class="alert alert-light text-center col-lg-8 mx-auto mb-5 rounded-lg">
    <form method="get" action="/api/top" class="needs-validation clearfix" novalidate>
      <div class="form-group">
        <input class="w-100 bg-transparent border-top-0 border-right-0 border-left-0 border-primary display-4 text-white" type="text" placeholder="Name your topic." id="inputLarge" name="topic" required />
        <div class="valid-feedback">Looks good!</div>
        <div class="invalid-feedback">Topic is required.</div>
      </div>
      <div class="btn-group btn-group-toggle float-right" data-toggle="buttons">
        <label class="btn btn-outline-primary active"><input type="radio" name="level" id="option1" autocomplete="off" value="1" checked="" />Basic</label>
        <label class="btn btn-outline-primary"><input type="radio" name="level" id="option2" autocomplete="off" value="2" />Intermediate</label>
        <label class="btn btn-outline-primary"><input type="radio" name="level" id="option3" autocomplete="off" value="3" />Advanced</label>
      </div>
      <div class="form-group float-left">
        <button type="submit" class="btn btn-primary">Let's go!</button>
      </div>
    </form>
  </div>

  {% if object_list %}
    <p class="text-xl-left">Or review one of these.</p>
    <div class="row">
      {% for topic in object_list %}
        <div class="card border-success mb-3" style="max-width: 20rem;">
          <div class="card-header">{{ topic }}</div>
          <div class="card-body">
            <h4 class="card-title">{{ topic }}</h4>
            <p class="card-text">{{ topic.description }}</p>
            <a class="btn btn-primary stretched-link" href="{{ topic.get_absolute_url }}">
              <i class="fa fa-folder-open"></i>
              Open topic
            </a>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endblock %}

{% block extrajs %}
  <script>
    // Example starter JavaScript for disabling form submissions if there are invalid fields
    ;(function () {
      'use strict'
      window.addEventListener(
        'load',
        function () {
          // Fetch all the forms we want to apply custom Bootstrap validation styles to
          var forms = document.getElementsByClassName('needs-validation')
          // Loop over them and prevent submission
          var validation = Array.prototype.filter.call(forms, function (form) {
            form.addEventListener(
              'submit',
              function (event) {
                if (form.checkValidity() === false) {
                  event.preventDefault()
                  event.stopPropagation()
                }
                form.classList.add('was-validated')
              },
              false
            )
          })
        },
        false
      )
    })()
    
    $('form').on(
      'submit',
      /** @this HTMLFormElement */
      async function (e) {
        e.preventDefault()
        const $form = $(e.currentTarget)
        if (!$form[0].checkValidity()) {
          return
        }
        const url = $form.attr('action')
        const props = Object.fromEntries(new FormData(this).entries())
        const response = await fetch(url, {
          method: 'POST',
          cache: 'no-cache',
          headers: { 'X-CSRFToken': '{{ csrf_token }}' },
          mode: 'same-origin',
          body: JSON.stringify(props)
        })
        const body = await response.json()
      }
    )
  </script>
{% endblock %}
